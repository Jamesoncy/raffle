var fs = require('fs');
var send = require('koa-send');

module.exports = {
  /**
   * Middleware for serving up static files.
   * @param  {[string]} directory Path to your static file directory.
   * @return {[function]}         Middleware function.
   */
  static: function(directory) {

    return function(ctx, next) {
      if (ctx.method === 'GET') {
        if ('/' === ctx.path) {
          return send(ctx, 'index.html', { root: directory });
        } else {
          if (fs.existsSync(directory + ctx.path)) {
            const path = ctx.path.replace(/^\/+/, '');
            return send(ctx, path, { root: directory });
          } else {
            return next();
          }
        }
      } else {
        return next();
      }
    };
  }
};
